<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>AdMatch - Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
</head>
<body>
  <header>
    <h1>AdMatch</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="upload.html" class="active">Upload</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="pricing.html">Pricing</a>
      <a href="legal.html">Legal</a>
      <a href="start.html">Aan de slag</a>
      <a href="admaker.html">AdMaker</a>
    </nav>
  </header>
  <main>
    <section class="upload-section">
      <h2>Advertentie uploaden</h2>
      <form id="uploadForm" enctype="multipart/form-data" autocomplete="off">
        <div class="form-group">
          <label for="subject">Onderwerp <span style="color:#2979ff">*</span></label>
          <input type="text" id="subject" name="subject" required placeholder="Typ om te zoeken..." autocomplete="off" list="subjectsList">
          <datalist id="subjectsList"></datalist>
        </div>
        <div class="form-group">
          <label for="type">Type advertentie <span style="color:#2979ff">*</span></label>
          <select id="type" name="type" required>
            <option value="">Kies type...</option>
            <option value="image">Afbeelding</option>
            <option value="video">Video</option>
            <option value="tekst">Tekst</option>
            <option value="audio">Audio</option>
            <option value="andere">Anders</option>
          </select>
        </div>
        <div class="form-group">
          <label for="companies">Bedrijven (komma-gescheiden)</label>
          <input type="text" id="companies" name="companies" placeholder="Bijv. Coolblue, Bol.com, Apple">
        </div>
        <div class="form-group">
          <label for="text">Advertentie tekst</label>
          <textarea id="text" name="text" rows="3" placeholder="Korte omschrijving of tekst..."></textarea>
        </div>
        <div class="form-group">
          <label for="file">Bestand (optioneel)</label>
          <input type="file" id="file" name="file" accept="image/*,video/*,audio/*">
        </div>
        <div class="form-group" style="margin-top:2em;">
          <label>Developer API key <span style="color:#b8b8d1;font-size:0.9em;">(optioneel, alleen voor developers)</span></label>
          <input type="text" id="apiKey" name="apiKey" placeholder="API key (alleen invullen als developer)">
        </div>
        <div class="form-group">
          <label>Developer Secret <span style="color:#b8b8d1;font-size:0.9em;">(optioneel, alleen voor developers)</span></label>
          <input type="text" id="secret" name="secret" placeholder="Secret (alleen invullen als developer)">
        </div>
        <div style="margin-top:2em;">
          <button class="button" type="submit">Uploaden</button>
        </div>
        <div id="uploadResult" style="margin-top:2em;"></div>
      </form>
      <div style="margin-top:2em;color:#b8b8d1;font-size:0.97em;">
        <b>Let op:</b> Developers moeten altijd hun eigen API key + secret invullen. Voor uploads via de officiële AdMatch-site hoef je deze velden niet in te vullen.
      </div>
    </section>
  </main>
  <script>
    // Onderwerpen laden en autocomplete vullen
    fetch(window.config.apiUrl + '/api/admatch/subjects').then(r=>r.json()).then(data => {
      const list = document.getElementById('subjectsList');
      list.innerHTML = '';
      data.subjects.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        list.appendChild(opt);
      });
    });
    // Upload formulier handler
    document.getElementById('uploadForm').onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      // userId ophalen (vereist)
      let userId = localStorage.getItem('userId') || prompt('Vul je gebruikers-ID in:');
      if (!userId) return alert('Gebruikers-ID vereist!');
      formData.set('userId', userId);
      // API key/secret optioneel (alleen developers)
      const apiKey = form.apiKey.value.trim();
      const secret = form.secret.value.trim();
      if (apiKey && !secret) return alert('Vul zowel API key als secret in, of laat beide leeg.');
      if (secret && !apiKey) return alert('Vul zowel API key als secret in, of laat beide leeg.');
      if (apiKey) formData.set('apiKey', apiKey);
      if (secret) formData.set('secret', secret);
      // Upload uitvoeren
      const resultBox = document.getElementById('uploadResult');
      resultBox.innerText = 'Uploaden...';
      try {
        const resp = await fetch(window.config.apiUrl + '/api/admatch/upload', {
          method: 'POST',
          body: formData
        });
        const data = await resp.json();
        if (!resp.ok) {
          resultBox.innerHTML = '<span style="color:#ff5252">Fout: ' + (data.error||'Onbekende fout') + '</span>';
        } else {
          resultBox.innerHTML = '<span style="color:#1db954">Succes! Advertentie geüpload (id: '+data.id+')</span>' + (data.unlimited ? ' <span style="color:#2979ff">(onbeperkt)</span>' : '') + (data.usage!==undefined ? `<br>Gebruikt: ${data.usage} / ${data.limit}` : '');
          form.reset();
        }
      } catch (err) {
        resultBox.innerHTML = '<span style="color:#ff5252">Fout bij uploaden</span>';
      }
    };
  </script>
</body>
</html>
